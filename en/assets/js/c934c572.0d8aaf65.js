"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[50432],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,g=d["".concat(l,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(g,s(s({ref:t},p),{},{components:n})):r.createElement(g,s({ref:t},p))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[d]="string"==typeof e?e:a,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},43448:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));const o={},s="Cross-domain",i={unversionedId:"extensions/cross_domain",id:"extensions/cross_domain",title:"Cross-domain",description:"Common cross-domain components are applicable to @midwayjs/faas, @midwayjs/web, @midwayjs/koa, and @midwayjs/express frameworks, and support multiple modes of cors and jsonp.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/extensions/cross_domain.md",sourceDirName:"extensions",slug:"/extensions/cross_domain",permalink:"/en/docs/extensions/cross_domain",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/extensions/cross_domain.md",tags:[],version:"current",frontMatter:{},sidebar:"component",previous:{title:"Static file hosting",permalink:"/en/docs/extensions/static_file"},next:{title:"HTTP proxy",permalink:"/en/docs/extensions/http-proxy"}},l={},c=[{value:"Installation dependency",id:"installation-dependency",level:2},{value:"Introducing components",id:"introducing-components",level:2},{value:"What is CORS",id:"what-is-cors",level:2},{value:"Common CORS configurations",id:"common-cors-configurations",level:2},{value:"<code>credentials</code> not used",id:"credentials-not-used",level:3},{value:"Using <code>credentials</code>",id:"using-credentials",level:3},{value:"Limit <code>origin</code>",id:"limit-origin",level:3},{value:"More CORS configuration",id:"more-cors-configuration",level:2},{value:"JSONP configuration",id:"jsonp-configuration",level:2}],p={toc:c},d="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"cross-domain"},"Cross-domain"),(0,a.kt)("p",null,"Common cross-domain components are applicable to ",(0,a.kt)("inlineCode",{parentName:"p"},"@midwayjs/faas"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"@midwayjs/web"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"@midwayjs/koa"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"@midwayjs/express")," frameworks, and support multiple modes of ",(0,a.kt)("inlineCode",{parentName:"p"},"cors")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"jsonp"),"."),(0,a.kt)("p",null,"Related information:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Web support"),(0,a.kt)("th",{parentName:"tr",align:null}))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@midwayjs/koa"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@midwayjs/faas"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@midwayjs/web"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@midwayjs/express"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2705")))),(0,a.kt)("h2",{id:"installation-dependency"},"Installation dependency"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ npm i @midwayjs/cross-domain --save\n")),(0,a.kt)("h2",{id:"introducing-components"},"Introducing components"),(0,a.kt)("p",null,"Introducing components in ",(0,a.kt)("inlineCode",{parentName:"p"},"src/configuration.ts"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import * as crossDomain from '@midwayjs/cross-domain';\n@Configuration({\n  imports: [\n    // ...other components\n    crossDomain\n  ],\n})\nexport class MainConfiguration {}\n")),(0,a.kt)("h2",{id:"what-is-cors"},"What is CORS"),(0,a.kt)("p",null,"The following errors are often encountered when front-end code calls back-end services. This is the most common cross-domain ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS"},"CORS")," error. ."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Access to fetch at 'http://127.0.0.1:7002/' from origin 'http://127.0.0.1:7001' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.\n")),(0,a.kt)("p",null,"For security reasons, browsers restrict cross-origin HTTP requests made within scripts. For example, ",(0,a.kt)("inlineCode",{parentName:"p"},"XMLHttpRequest")," and ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-CN/docs/Web/API/Fetch_API"},"Fetch API")," follow the ","[Same Origin Policy]","(",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/"},"https://developer.mozilla.org/")," en-CN/docs/Web/Security/Same-origin_policy). This means that web applications using these APIs can only request HTTP resources from the same domain where the application is loaded unless the response message contains the correct CORS response headers."),(0,a.kt)("p",null,"The CORS mechanism allows web application servers to perform cross-origin access control so that cross-origin data transmission can be carried out securely. Modern browsers support this in API containers such as ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest"},(0,a.kt)("inlineCode",{parentName:"a"},"XMLHttpRequest"))," or ","[Fetch]","(",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla"},"https://developer.mozilla")," .org/zh-CN/docs/Web/API/Fetch_API)) uses CORS to reduce the risks caused by cross-origin HTTP requests."),(0,a.kt)("h2",{id:"common-cors-configurations"},"Common CORS configurations"),(0,a.kt)("p",null,"Below are several cross-domain solutions. Let\u2019s take the ",(0,a.kt)("inlineCode",{parentName:"p"},"fetch")," method as an example."),(0,a.kt)("h3",{id:"credentials-not-used"},(0,a.kt)("inlineCode",{parentName:"h3"},"credentials")," not used"),(0,a.kt)("p",null,"client."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"fetch(url);\n")),(0,a.kt)("p",null,"Server configuration."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport default {\n   // ...\n   cors: {\n     origin: '*',\n   },\n}\n")),(0,a.kt)("h3",{id:"using-credentials"},"Using ",(0,a.kt)("inlineCode",{parentName:"h3"},"credentials")),(0,a.kt)("p",null,"client."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'fetch(url, {\n   credentials: "include",\n});\n')),(0,a.kt)("p",null,"Server configuration"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport default {\n   // ...\n   cors: {\n     credentials: true,\n   },\n}\n")),(0,a.kt)("h3",{id:"limit-origin"},"Limit ",(0,a.kt)("inlineCode",{parentName:"h3"},"origin")),(0,a.kt)("p",null,"Suppose our web page address is ",(0,a.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:7001")," and the interface is ",(0,a.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:7002"),"."),(0,a.kt)("p",null,"client."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"fetch('http://127.0.0.1:7002/', {\n   credentials: 'include'\n})\n")),(0,a.kt)("p",null,"Server configuration, please note that since ",(0,a.kt)("inlineCode",{parentName:"p"},"credentials")," is enabled, the ",(0,a.kt)("inlineCode",{parentName:"p"},"origin")," field cannot be ",(0,a.kt)("inlineCode",{parentName:"p"},"*")," at this time."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport default {\n   // ...\n   cors: {\n     origin: 'http://127.0.0.1:7001',\n     credentials: true,\n   },\n}\n")),(0,a.kt)("h2",{id:"more-cors-configuration"},"More CORS configuration"),(0,a.kt)("p",null,"The available configurations are as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"export const cors = {\n    // Allow cross-domain methods, [default value] is GET, HEAD, PUT, POST, DELETE, PATCH\n  allowMethods: string |string[];\n  // Set the value of Access-Control-Allow-Origin, and [Default] will get the origin on the request header\n  // It can also be configured as a callback method. The input parameter is request and the origin value needs to be returned.\n  // For example: http://test.midwayjs.org\n  // If credentials is set, origin cannot be set *\n  origin: string|Function;\n  // Set the value of Access-Control-Allow-Headers, [Default] will get Access-Control-Request-Headers on the request head\n  allowHeaders: string |string[];\n  // Set the value of Access-Control-Expose-Headers\n  exposeHeaders: string |string[];\n  // Set Access-Control-Allow-Credentials, [Default] false\n   // It can also be configured as a callback method. The input parameter is request and the return value is true or false.\n  credentials: boolean|Function;\n  // Whether to write cross-domain header information to the headers attribute of the error pair when an error is reported, [default value] false\n  keepHeadersOnError: boolean;\n    // set Access-Control-Max-Age\n  maxAge: number;\n}\n")),(0,a.kt)("h2",{id:"jsonp-configuration"},"JSONP configuration"),(0,a.kt)("p",null,"JSONP can be configured in ",(0,a.kt)("inlineCode",{parentName:"p"},"src/config/config.default"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport default {\n  // ...\n  jsonp: {\n    callback: 'jsonp',\n    limit: 512\n  },\n}\n")))}u.isMDXComponent=!0}}]);